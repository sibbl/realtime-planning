<section class="navbar navbar-inverse" id="collaborators">
    <div class="container ">
        <a class="navbar-brand" href="#">Realtime Planning</a>
        <div class="pull-right">
            <img ng-repeat="collaborator in collaborators | limitTo: 5"
                 ng-src="{{collaborator.photoUrl}}"
                 alt="{{collaborator.displayName}}"
                 title="{{collaborator.displayName}}"
                 ng-style="{'background-color': collaborator.color}">
            <button type="button" class="btn btn-default navbar-btn" ng-click="share()" id="share">share</button>
        </div>
        <div class="clearfix"></div>
    </div>
</section>

<section class="container" id="planningapp">
    <header id="header">
        <form class="input-group" id="category-form" ng-submit="addCategory()">
            <input type="text" class="form-control" id="new-category-item" placeholder="Add another category" ng-model="newCategoryTitle" autofocus>
            <span class="input-group-btn">
                <button type="button" class="btn btn-default" ng-click="addCategory()"><span class="glyphicon glyphicon-plus"></span></button>
            </span>
        </form>
    </header>
    <section id="main">
    <div class="row" ng-repeat="categoryIndex in planCategoriesRange()"  ng-show="planCategories.length" ng-cloak>
        <div class="col-md-{{(12/itemsPerRow)}}" ng-repeat="category in planCategories.asArray().slice(categoryIndex, categoryIndex+itemsPerRow)">
            <div class="panel panel-default" >
                <div class="panel-heading hide-editing-form" ng-class="{editing: category == editedItem}">
                    <div class="view">
                        <label ng-dblclick="startEditing(category)">{{category.title.text}}</label>
                        <button class="btn btn-default btn-xs pull-right" ng-click="removeCategory(category)"><span class="glyphicon glyphicon-trash"></span></button>
                    </div>
                    <form ng-submit="doneEditing(category)">
                        <input class="form-control edit" ng-model="category.title.text" collaborative on-blur="doneEditing()" focus="category == editedItem">
                    </form>
                </div>
                <ul class="plan-item-list panel-body">
                    <li ng-repeat="item in category.items.asArray()" ng-class="{editing: item == editedItem}">
                        <div class="title">
                            <div class="view">
                                <label ng-dblclick="startEditing(item)">{{item.title.text}}</label>
                                <button class="destroy" ng-click="removeItem(categoryIndex, item)"></button>
                            </div>
                            <form ng-submit="doneEditing(item)">
                                <input class="edit" ng-model="item.title.text" collaborative on-blur="doneEditing()" focus="item == editedItem">
                            </form>
                        </div>
                        <div class="distribution-input">
                            <div class="consume">
                                I consume:
                                <form ng-submit="doneEditing(item)">
                                    <input class="input" ng-model="item.distribution.get(currentUser.userId).consumeCount.text" collaborative on-blur="doneEditing()" only-digits>
                                </form>
                            </div>
                            <div class="provide">
                                I provide:
                                <form ng-submit="doneEditing(item)">
                                    <input class="input" ng-model="item.distribution.get(currentUser.userId).provideCount.text" collaborative on-blur="doneEditing()" only-digits>
                                </form>
                            </div>
                        </div>
                        <div class="distribution-list">
                            <ul>
                                <li ng-repeat="userId in item.distribution.keys()">
                                    <div class="thumb">
                                        <img ng-src="{{getUser(userId).photoUrl}}"
                                             alt="{{getUser(userId).displayName}}"
                                             title="{{getUser(userId).displayName}}"
                                             ng-style="{'background-color': getUser(userId).color}">
                                    </div>
                                    <div class="username">{{getUser(userId).displayName}}</div>

                                    <div class="consume">consumes: {{item.distribution.get(userId).consumeCount.text}}</div>
                                    <div class="provides">provides: {{item.distribution.get(userId).provideCount.text}}</div>
                                </li>
                            </ul>
                        </div>
                    </li>
                </ul>
            
                <form class="panel-footer" ng-submit="addItem(categoryIndex)">
                    <input class="form-control" placeholder="What do we need?" ng-model="newItemTitle">
                </form>
            </div>
        </div>
    </section>
</section>